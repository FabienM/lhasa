name: Applications Endpoint TestSuite
vars:
  baseroute: '{{.APP_HOST}}/api/v1'
  appsroute: '{{.baseroute}}/applications'
testcases:
- name: Reset the Database
  steps:
    - type: http
      method: POST
      url: '{{.APP_HOST}}/api/v0/flushdb'
      headers:
      assertions:
      - result.statuscode ShouldEqual 200

- name: Add an Application
  steps:
    - type: http
      method: PUT
      url: "{{.appsroute}}/agora/api/1"
      body: '{"profile": "agora", "name":"api", "type": "api", "language": "python"}'
      headers:
      assertions:
      - result.statuscode ShouldEqual 201

- name: Get an Application
  steps:
    - type: http
      method: GET
      url: "{{.appsroute}}/agora/api/1"
      headers:
      assertions:
      - result.statuscode ShouldEqual 200
      - result.bodyjson.type ShouldEqual api
      - result.bodyjson.name ShouldEqual api
      - result.bodyjson.profile ShouldEqual agora


- name: List Applications
  steps:
    - type: http
      method: GET
      url: "{{.appsroute}}"
      headers:
      assertions:
      - result.statuscode ShouldEqual 206
      - result.bodyjson.pagemetadata.totalelements ShouldEqual 1
      - result.bodyjson.pagemetadata.totalpages ShouldEqual 1
      - result.bodyjson.pagemetadata.number ShouldEqual 0
      - result.bodyjson.content.content0.type ShouldEqual api
      - result.bodyjson.content.content0.name ShouldEqual api
      - result.bodyjson.content.content0.profile ShouldEqual agora

- name: Delete an Application
  steps:
    - type: http
      method: DELETE
      url: "{{.appsroute}}/agora/api/1"
      headers:
      assertions:
      - result.statuscode ShouldEqual 204

- name: List Applications
  steps:
    - type: http
      method: GET
      url: "{{.appsroute}}"
      headers:
      assertions:
      - result.statuscode ShouldEqual 206
      - result.bodyjson.content.__len__ ShouldEqual 0

- name: Add an Application
  steps:
    - type: http
      method: PUT
      url: "{{.appsroute}}/agora/api/1"
      body: '{"name": "api", "profile":"agora", "type": "api", "language": "python", "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi eget enim turpis. Sed at nunc a lectus malesuada vehicula vitae tempus ante. Ut nec consequat augue. Aliquam imperdiet id tortor ut maximus. Phasellus facilisis nibh nec mauris tristique consequat. Donec nisi mauris, lobortis eu turpis vulputate, malesuada vehicula dolor. Ut mattis libero a sagittis faucibus. Fusce enim enim, consectetur at ultrices ut, mollis nec felis. In vehicula leo nec ex accumsan iaculis. Phasellus tempor dui sem, vel pulvinar enim molestie ut. Cras sit amet lacus eleifend velit consequat ultricies sed vitae nisl. Etiam mollis viverra justo, convallis pellentesque mauris vestibulum ac."}'
      headers:
      assertions:
      - result.statuscode ShouldEqual 201

- name: Add an Application2
  steps:
    - type: http
      method: PUT
      url: "{{.appsroute}}/cds/cds/1"
      body: '{"name": "cds", "profile":"cds", "type": "api", "language": "go", "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi eget enim turpis. Sed at nunc a lectus malesuada vehicula vitae tempus ante. Ut nec consequat augue. Aliquam imperdiet id tortor ut maximus. Phasellus facilisis nibh nec mauris tristique consequat. Donec nisi mauris, lobortis eu turpis vulputate, malesuada vehicula dolor. Ut mattis libero a sagittis faucibus. Fusce enim enim, consectetur at ultrices ut, mollis nec felis. In vehicula leo nec ex accumsan iaculis. Phasellus tempor dui sem, vel pulvinar enim molestie ut. Cras sit amet lacus eleifend velit consequat ultricies sed vitae."}'
      headers:
      assertions:
      - result.statuscode ShouldEqual 201
      
- name: Add an Application3
  steps:
    - type: http
      method: PUT
      url: "{{.appsroute}}/batch_mailer/batch_mailer/1"
      body: '{"name": "batch_mailer", "profile":"batch_mailer", "type": "cronjob", "language": "perl", "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi eget enim turpis. Sed at nunc a lectus malesuada vehicula vitae tempus ante. Ut nec consequat augue. Aliquam imperdiet id tortor ut maximus. Phasellus facilisis nibh nec mauris tristique consequat. Donec nisi mauris, lobortis eu turpis vulputate, malesuada vehicula dolor. Ut mattis libero a sagittis faucibus. Fusce enim enim, consectetur at ultrices ut, mollis nec felis. In vehicula leo nec ex accumsan iaculis. Phasellus tempor dui sem, vel pulvinar enim molestie ut. Cras sit amet lacus eleifend velit consequat ultricies sed vitae."}'
      headers:
      assertions:
      - result.statuscode ShouldEqual 201
